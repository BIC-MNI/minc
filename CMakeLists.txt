# CMakeFiles.txt for the EZminc
#
# Vladimir S. FONOV - vladimir.fonov@gmail.com

CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_CURRENT_SOURCE_DIR}/cmake-modules")

IF(NOT MINC_TOOLKIT_BUILD)
  PROJECT (ezminc)
  FIND_PACKAGE( MINC2 REQUIRED )
  
  FIND_PACKAGE(GSL)
  FIND_PACKAGE(FFTW3F)

  IF(USE_ITK_HDF5) # have to use HDF5 and Zlib from ITK
    FIND_PACKAGE(ITK REQUIRED)
    LINK_DIRECTORIES(${ITK_LIBRARY_DIRS})
  ELSE(USE_ITK_HDF5)
    FIND_PACKAGE(ITK)
  ENDIF(USE_ITK_HDF5)
ENDIF(NOT MINC_TOOLKIT_BUILD)


INCLUDE( ${MINC2_USE_FILE} )
OPTION(BUILD_MINCNLM  "Build Non-local means denoising programm,requires GSL (protected by a license IDDN.FR.001.070033.000.S.P.2007.000.21000)" OFF)
OPTION(BUILD_DISTORTION_CORRECTION "Build distortion correction tools, requires GSL" OFF)
OPTION(BUILD_MRFSEG   "Build mrfseg - tissue classification program from Jussi Tohka" OFF)
OPTION(BUILD_DD       "Build Diffeomorphic Demons (requires ITK)" OFF)


INCLUDE_DIRECTORIES( ${CMAKE_CURRENT_SOURCE_DIR}/image_proc )
ADD_SUBDIRECTORY( image_proc )

IF(GSL_FOUND)

  INCLUDE_DIRECTORIES( 
    ${GSL_INCLUDE_DIRS}
    ${CMAKE_CURRENT_SOURCE_DIR}/tools
  )

  IF(BUILD_MINCNLM)
    ADD_SUBDIRECTORY(mincnlm)
  ENDIF(BUILD_MINCNLM)
ENDIF(GSL_FOUND)

IF(FFTW3F_FOUND)
  INCLUDE_DIRECTORIES( ${FFTW3F_INCLUDE_DIRS})
ENDIF(FFTW3F_FOUND)

IF(BUILD_EZMINC_TOOLS )
  ADD_SUBDIRECTORY(tools)
ENDIF(BUILD_EZMINC_TOOLS)

IF(GSL_FOUND AND BUILD_DISTORTION_CORRECTION)
  ADD_SUBDIRECTORY( distortion_correction )
ENDIF(GSL_FOUND AND BUILD_DISTORTION_CORRECTION)

IF(BUILD_MRFSEG)
  ADD_SUBDIRECTORY(mrfseg)
ENDIF(BUILD_MRFSEG)

IF(ITK_FOUND)

  OPTION(BUILD_EZMINC_TOOLS "Build additional tools , requires GSL" OFF)

  IF(BUILD_DD)
    ADD_SUBDIRECTORY(diff_demons)
  ENDIF(BUILD_DD)

ENDIF(ITK_FOUND)
